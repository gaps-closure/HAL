# Autogeneration Utilities

This directory holds utilities for automatic generation of serialization codecs
for use with the HAL C API, DFDL files describing the on-wire data formats of
application data within GAPS PDUs,  DAGR files for provisioning guard rules,
HAL configuration files, and possibly other artificats needed to provision 
the guard hardware.  

Initially, we will focus on autogeneration of codecs and DFDL, other capabilities 
will be added later.

The input files for the autogeneration include: 
  1. Interface Definition Language (IDL) files of the cross-domain datatypes
  2. Security policy derived from CLE annotations 

These inputs can be generated by the CLOSURE tools (MULES and CAPO), or provided by the developer.

Currently DFDL generation is fully implemented; serialization codec generation is partially implemented.

Next steps:

 * We are missing 3 low-level functions (pack/unpack for 32-bit float, 64-bit ntohll) in the generated float.c/.h
 * Test 1: update the sample IDL to include a struct will all possible options, and test auto-generation of DFDL and codec 
create a test program that creates a sample instance, print, encode, decode, print
 * Test 2: Based on the DFDL, manually create a sample instance infoset, unparse to binary, decode, encode, print
 * Integrate with CLOSURE toolchain (figure out how to make CAPO generate this IDL)
 * Develop approach to autogenerate DAGR from CLE-JSON companion file 
 * Add support for generating user-defined-function stubs for arbitrary classes/datatypes 

To invoke the autogeneration utility:
```
./autogen.py -g be_v1 -i sample.idl -d gmabe.dfdl.xsd -e codec
./autogen.py -g bw_v1 -i sample.idl -d gmabw.dfdl.xsd -e codec
```

## Interface Definition Language Syntax

The IDL syntax is based on C; an IDL file contains one or more C struct datatypes. 
See `sample.idl` for an example.

Datatype tags are assigned numerically in the order the structs are found in the file.
Not all valid C struct declarations are supported.

Currently we support the following atomic types: char (8b), unsigned char (8b), short (16b),
unsigned short (16b), int (32b), unsigned int (32b), long (64b), unsigned long (64b), float (4B), 
double (8B). We also support fixed-size arrays of any supported atomic type.

Support for null-terminated C-strings, and C++ datatypes such as std::string,
std::array, and std::vector is future work.

